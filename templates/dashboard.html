<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Smart Soil Monitoring</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    <!-- BACKGROUND DECOR -->
    <div class="bg-leaf leaf-1"></div>
    <div class="bg-leaf leaf-2"></div>

    <header>
      <h1>ðŸŒ± Smart Soil Monitoring</h1>
      <p>Sistem Monitoring Kelembaban Tanah & Kapas</p>
    </header>

    <main>
      <div class="cards">
        <div class="card soil" id="card-soil">
          <div class="card-header">
            <span>ðŸŒ¾ Tanah/Kapas</span>
            <span class="badge" id="status">--</span>
          </div>

          <div class="card-value">
            <span id="moisture">--</span>
            <small>%</small>
          </div>

          <p class="time" id="time">--</p>
        </div>
      </div>

      <!-- STATUS AUTO UPDATE + MANUAL -->
      <div class="auto-status">
        ðŸŸ¢ Auto Update Aktif
      </div>
    </main>

    <div class="data-section">
      <!-- GRAFIK -->
      <div class="chart-box">
        <h3>Grafik Kelembaban Tanah</h3>
        <canvas id="moistureChart"></canvas>
      </div>

      <!-- TABEL -->
      <div class="table-box">
        <h3>Data Kelembaban</h3>
        <table>
          <thead>
            <tr>
              <th>No</th>
              <th>Kelembaban (%)</th>
              <th>Waktu</th>
            </tr>
          </thead>
          <tbody>
            {% for row in rows %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ row.moisture }}</td>
              <td>{{ row.created_at.strftime("%Y-%m-%d %H:%M:%S") }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <footer>
      <p>Raspberry Pi 4 Â· Flask Â· MySQL Â· IoT Agriculture</p>
    </footer>

    <script src="{{ url_for('static', filename='js/soil.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Data untuk chart dari backend (sudah di-convert ke dict)
      const chartData = {{ rows_json|tojson }};
    </script>
  </body>
</html>
